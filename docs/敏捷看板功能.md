# 敏捷看板功能说明

## 功能概述

敏捷看板是项目管理系统中的一个核心功能模块，用于可视化展示和管理迭代中的任务。它提供了直观的看板界面，让用户能够轻松跟踪任务进度，并支持实时更新任务状态。

## 功能结构

敏捷看板功能主要由以下几个部分组成：

1. **看板视图** - 以看板形式展示任务，按状态分列
2. **概览视图** - 展示项目和迭代基本信息，以及燃尽图
3. **任务详情** - 查看和编辑任务详细信息
4. **任务状态更新** - 实时更新任务状态和负责人

## 核心功能

### 1. 看板视图

看板视图将任务按照状态分为三列：
- 待处理（未开始）
- 进行中
- 已完成

每张任务卡片显示以下信息：
- 任务名称
- 任务编号
- 所属用户故事
- 优先级（高、中、低）
- 负责人

用户可以通过点击任务卡片查看详细信息，并在详情弹窗中直接修改任务状态和负责人。

### 2. 概览视图

概览视图包含两个主要部分：
- 项目与迭代信息面板
- 迭代燃尽图

项目与迭代信息面板显示：
- 项目名称和简称
- 迭代名称、起止日期、状态
- 产品负责人和Scrum Master

燃尽图展示：
- 实际剩余故事点数曲线
- 理想燃尽线

### 3. 任务管理

用户可以在任务详情弹窗中：
- 查看任务详细信息
- 修改任务状态（未开始、进行中、已完成）
- 分配/重新分配任务负责人

所有修改都会实时保存，并自动刷新看板视图。

### 4. 任务筛选功能

看板视图支持按负责人筛选任务，帮助用户快速定位特定人员负责的任务：
- 全部任务：显示所有分配的任务
- 未分配：仅显示尚未分配负责人的任务
- 按人员筛选：显示指定负责人分配的任务

筛选功能与看板视图集成，用户可以在查看特定人员任务的同时进行拖拽操作和状态更新。

## 技术实现

### 后端实现

#### 路由和控制器
看板功能由 `routes/kanban.py` 文件实现，主要包括以下路由：

1. `/kanban` - 显示看板页面
2. `/get_kanban_data/<int:sprint_id>` - 获取指定迭代的看板数据
3. `/get_task_detail/<int:task_id>` - 获取任务详情

#### 数据处理
看板数据处理涉及以下模型：
- Sprint（迭代）
- UserStory（用户故事）
- Task（任务）
- ProjectInfo（项目信息）
- User（用户）

#### 燃尽图计算
系统通过 [calculate_burndown_data](file://D:\projects\agile-dev\routes\kanban.py#L134-L229) 函数计算燃尽图数据：
1. 计算迭代总故事点数
2. 生成日期范围（从迭代开始到结束）
3. 计算理想燃尽线数据
4. 根据任务完成情况计算实际剩余故事点数

### 前端实现

#### 页面结构
看板页面使用 Bootstrap 框架构建，主要包含：
- 迭代选择器
- Tab 导航（概览和看板两个标签页）
- 响应式布局

#### 交互功能
前端通过 AJAX 与后端通信，实现：
- 动态加载看板数据
- 实时更新任务状态
- 任务详情弹窗展示
- 消息提示系统
- 任务筛选功能

#### 图表展示
使用 Chart.js 库绘制燃尽图，展示：
- 实际剩余故事点曲线
- 理想燃尽线

## 权限控制

看板功能通过装饰器进行权限控制：
- 用户需要具有 `kanban.kanban` 权限才能访问看板页面
- 所有 AJAX 请求都会检查相应权限

## 使用流程

1. 用户进入看板页面
2. 选择要查看的迭代
3. 系统加载该迭代的看板数据
4. 用户可以在概览和看板两个视图间切换
5. 在看板视图中，用户可以使用筛选器按负责人查看任务
6. 点击任务卡片查看详细信息
7. 在任务详情弹窗中修改任务状态或负责人
8. 系统自动刷新看板视图以反映最新状态

## 特色功能

1. **实时更新** - 任务状态变更后立即刷新看板
2. **可视化展示** - 通过燃尽图直观展示迭代进度
3. **便捷操作** - 在任务详情弹窗中可直接修改任务状态和负责人
4. **响应式设计** - 适配不同屏幕尺寸
5. **多视图切换** - 支持概览和看板两种视图
6. **任务筛选** - 支持按负责人筛选任务，提高工作效率

