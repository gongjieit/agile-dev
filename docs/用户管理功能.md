# 系统用户管理功能说明

## 功能概述

系统用户管理功能是平台管理员用来管理平台用户的核心模块，包括用户列表展示、角色分配、用户删除等功能。该模块只对具有管理员权限的用户开放。

## 数据模型

### User 模型
```python
class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(80), unique=True, nullable=False)  # 用户名
    password_hash = db.Column(db.String(128), nullable=False)     # 密码哈希值
```


### Role 模型
```python
class Role(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(80), unique=True, nullable=False)        # 角色名
    display_name = db.Column(db.String(80), nullable=False)             # 角色显示名称
```


### UserRole 模型（用户角色关联）
```python
class UserRole(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)  # 用户ID
    role_id = db.Column(db.Integer, db.ForeignKey('role.id'), nullable=False)  # 角色ID
    
    # 关联关系
    user = db.relationship('User', backref='user_roles')
    role = db.relationship('Role', backref='role_users')
```


## 主要功能

### 1. 用户列表展示
- 展示系统中所有用户的信息
- 显示用户的ID、用户名和角色
- 为当前登录用户显示特殊标识

### 2. 角色分配
- 管理员可以为用户分配一个或多个角色
- 通过模态框界面进行角色选择和分配
- 支持更新用户的角色分配

### 3. 用户删除
- 管理员可以删除用户（不能删除自己）
- 删除前进行确认提示
- 删除用户时同时清理相关的估算记录

## 界面设计

### 主界面
- 顶部导航栏包含功能菜单
- 面包屑导航显示当前位置
- 标题区域显示"用户管理"
- 返回首页按钮
- 用户列表表格展示所有用户信息

### 用户列表
- 表格列包括：ID、用户名、角色、操作
- 当前登录用户在操作列显示"当前用户"文本
- 其他用户显示"分配角色"按钮和"删除"按钮

### 分配角色模态框
- 显示目标用户的用户名
- 列出系统中所有可用角色（复选框形式）
- 确认和取消按钮

## 权限控制

- 只有具有管理员权限的用户才能访问用户管理功能
- 不能删除当前登录用户
- 不能为自己分配角色（需要另一个管理员操作）

## API 接口

### 获取用户列表
- 路径：`/users/`
- 方法：GET
- 功能：展示用户列表页面

### 删除用户
- 路径：`/users/delete_user/<int:user_id>`
- 方法：POST
- 功能：删除指定用户（不能删除自己）

### 分配角色
- 路径：`/users/assign_roles/<int:user_id>`
- 方法：POST
- 参数：角色ID列表
- 功能：为用户分配角色

### 获取用户角色
- 路径：`/users/get_roles/<int:user_id>`
- 方法：GET
- 功能：获取指定用户的角色列表

## 角色管理

系统中预定义了多种角色，包括：
- admin：系统管理员
- po：产品负责人
- sm：Scrum Master
- dev：开发人员
- tester：测试人员
- guest：访客

每个角色可以被分配不同的系统功能权限。

## 数据安全

- 用户密码采用哈希存储，不保存明文密码
- 删除用户时自动清理相关联的估算记录
- 操作前进行权限验证
- 删除操作前进行二次确认

## 注意事项

1. 管理员不能删除自己，避免系统无管理员用户
2. 角色分配具有即时性，分配后用户立即获得相应权限
3. 删除用户是不可逆操作，需要谨慎操作
4. 用户名在系统中是唯一的

该文档整理了系统用户管理功能的主要内容，涵盖了功能概述、数据模型、主要功能、界面设计、权限控制、API接口等方面的信息。